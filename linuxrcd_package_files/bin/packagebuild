#! /bin/bash
#this script will take one argument, that is the package name to be built
buildpackage=$1

#apply the patches that come with the source files 
rm ../*.diff.gz
rm ../*.dsc

#patch up the .tar.gz files as some packages like to use them
find . -name "*.tar.gz"  | while read TARFILE
do
TARFILE=$(readlink -f $TARFILE)
#create a folder for modifying the original tar file, as debian quilt wants it
mkdir ORIGTAR

#change into the folder
cd ORIGTAR

#extract the orig.tar.gz file
tar -zxvf $TARFILE

#modify the source tree
sourceedit

#recreate the orig.tar.gz with the modified source
tar -zcvf  $TARFILE .
#change back
cd ..

#delete the folder for the orginal tar
rm -rf ORIGTAR
done




#change into the directory of the source code folder
cd *

#modify the source tree
sourceedit

#build the package
yes | debuild -us -uc
buildstatus=$?
#go back one directory into the directory made for the selected package
cd ..
#copy all build debs out of this folder and into the folder that will be be copied before the rest of the chroot environment gets deleted
cp *.deb /usr/packageoutput
cp *.udeb /usr/packageoutput
#go back one directory into the directory this script was started.
cd .. 

#clean up the builddir 
rm -rf $buildpackage



if [ $buildstatus -eq 0 ]
then
exit 0
else
exit 1
fi